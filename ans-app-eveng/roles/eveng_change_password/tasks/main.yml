---
- name: Install required packages
  apt:
    name: "{{ item }}"
    state: present
  loop:
    - python3-pip
    - python3-mysql.connector

- name: Install PyMySQL via pip
  pip:
    name: PyMySQL
    state: present

- name: Update EVENG password in mysql
  community.mysql.mysql_query:
    login_db: eve_ng_db
    login_user: root
    login_password: eve-ng
    login_unix_socket: /var/run/mysqld/mysqld.sock
    query:
      - DELETE from users where username = 'admin'
      - INSERT INTO users VALUES ('admin',NULL,'root@localhost',-1,'Eve-NGAdministrator','{{ eveng_admin_pass | hash('sha256') }}',NULL,'','admin','',1)
  no_log: true
